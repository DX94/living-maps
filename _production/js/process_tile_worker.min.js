/*! living-maps 28-05-2013 */
function next(){if(!processing){processing=!0;var a=queue.pop();a?get_data(a.url+"&format=bin",a.coord,a.coord.z,a.TIME_SLOTS):processing=!1}}function get_data(a,b,c,d){get(a,function(a){var e=null;a.response&&(e=new ArrayBufferSer(a.response)),postMessage(pre_cache_data1(e,b,c,d)),processing=!1,next()})}function pre_cache_data1(a,b,c,d){if(!a)return{coord:{x:b.x,y:b.y,z:c},timeCount:[]};for(var e=new Int32Array(d),f=new Int32Array(d),g=new Int32Array(a.length),h=new Int32Array(a.length),i=0,j=0;j<a.get("dates__uint16").length;++j){var k=a.get("dates__uint16")[j];i+=k.length}for(var l=new Uint8Array(i),m=new Uint32Array(i),n=256<<c,o=a.get("x__uint8"),p=a.get("y__uint8"),j=0;j<a.length;++j){var q=tilePixelToPixel(b.x,b.y,c,o[j],p[j]);g[j]=0|q[0],h[j]=0|n-q[1]}for(var r=0,s=0,t=0;d>t;++t){for(var u=0,j=0;j<a.length;++j)for(var i=a.get("dates__uint16")[j],v=a.get("vals__uint8")[j],w=0,x=i.length;x>w;++w)i[w]==t&&(++u,l[r]=v[w],m[r]=j,++r);e[t]=s,f[t]=u,s+=u}return{x:g,y:h,coord:{x:b.x,y:b.y,z:c},timeCount:f,timeIndex:e,renderDataPos:m,renderData:l}}importScripts("util.js"),importScripts("bin_decoder.js");var queue=[],processing=!1;onmessage=function(a){var b=JSON.parse(a.data);queue.push(b),next()};