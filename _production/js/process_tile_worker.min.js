/*! living-maps 28-05-2013 */
function get(a,b){var c=new XMLHttpRequest;return c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b(c):b(null))},c.open("GET",a,!0),c.send(null),c}function next(){if(!processing){processing=!0;var a=queue.pop();a?get_data(a.url,a.coord,a.coord.z,a.TIME_SLOTS):processing=!1}}function get_data(a,b,c,d){get(a,function(a){var e=JSON.parse(a.responseText);postMessage(pre_cache_data1(e.rows,b,c,d)),processing=!1,next()})}function pre_cache_data1(a,b,c,d){var e=new Int32Array(d),f=new Int32Array(d),g=new Int32Array(a.length),h=new Int32Array(a.length),i=0;for(var j in a){var k=a[j];i+=k.dates.length}var l=new Uint8Array(i),m=new Uint32Array(i),n=256<<c;for(var j in a){var k=a[j],o=tilePixelToPixel(b.x,b.y,c,k.x,k.y);g[j]=0|o[0],h[j]=0|n-o[1]}for(var p=0,q=0,r=0;d>r;++r){var s=0;for(var j in a)for(var k=a[j],t=0,u=k.dates.length;u>t;++t)k.dates[t]==r&&(++s,l[p]=k.vals[t],m[p]=j,++p);e[r]=q,f[r]=s,q+=s}return{x:g,y:h,coord:{x:b.x,y:b.y,z:c},timeCount:f,timeIndex:e,renderDataPos:m,renderData:l}}importScripts("util.min.js");var queue=[],processing=!1;onmessage=function(a){var b=JSON.parse(a.data);queue.push(b),next()};